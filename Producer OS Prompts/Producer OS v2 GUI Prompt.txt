
---

# ✅ AGENT MODE PROMPT — Producer OS v2 (GUI + CLI + EXE) — GPL, PySide6, Nuitka, Inno

You are an implementation agent rebuilding **Producer OS v2** as a **clean, stable, safe-by-default, open-source desktop tool** for organizing music sample packs and applying FL Studio folder styling via `.nfo` sidecars.

Repository reference:

* [https://github.com/KidChadd/Producer-OS/tree/main](https://github.com/KidChadd/Producer-OS/tree/main)

Primary goals:

* GUI-first wizard experience with excellent UX
* CLI support for power users
* Portable mode + AppData mode (strict rules below)
* Deterministic bucket routing with reason + confidence
* Clean FL Studio styling using `.nfo` sidecars (IconIndex-only)
* Idempotent behavior (safe to re-run)
* Repair mode (styles) + undo last run
* Open-source quality docs, schemas, tests
* Build into Windows EXE using **Nuitka** + **Inno Setup installer** + **portable zip**
* GitHub Actions builds releases
* License: **GPL-3.0-or-later**

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
STRICT PROCESS RULES (CRITICAL)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Before modifying code:

   * Inspect current repo structure.
   * Identify any UI → engine API mismatches.
   * Propose precise change-set + test plan in a short checklist.
   * Then implement.

2. Never delete user content (ever).

3. Default mode is safe: **Copy is the default action**.

4. Move must be explicit and must show confirmation.

5. Idempotency required: second run does nothing harmful.

6. No silent behavior changes: log decisions and actions.

7. Keep responsibilities separated:

   * engine = sorting/routing + reports + undo/repair
   * UI = wizard + settings + presentation only
   * CLI = wrapper around engine only

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
FOLDER STYLING: NFO LOCATION RULE (CRITICAL)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Style files are sibling `.nfo` files next to folders.

For any folder X:
style file must be `X.nfo` in the same parent directory.

Examples:

Category:
HUB\Samples\               → HUB\Samples.nfo

Bucket:
HUB\Samples\808s\          → HUB\Samples\808s.nfo

Pack folder (FIRST LEVEL ONLY):
HUB\Samples\808s\Spinz Pack
→ HUB\Samples\808s\Spinz Pack.nfo

Rules:

* Pack `.nfo` must reuse the **bucket style** (same Color/IconIndex/SortGroup).
* Never create per-WAV `.nfo`.
* Never create HUB\Category\Bucket\Bucket.nfo inside bucket folder.
* Only rewrite `.nfo` if contents differ.

NFO content format (exact):
Color=$...
IconIndex=...
HeightOfs=7
SortGroup=...
Tip=*Styled by Producer OS

No Bitmap=. IconIndex-only.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
CONFIG MODES (STRICT)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
APPDATA MODE (default)
%APPDATA%\ProducerOS\config.json
%APPDATA%\ProducerOS\bucket_styles.json
%APPDATA%\ProducerOS\logs...

PORTABLE MODE (REQUIRED)
Activation priority:

1. If portable.flag exists next to executable → ALWAYS portable.
2. Else if CLI flag --portable → portable.
3. Else → AppData mode.

Portable paths:
<APP_DIR>\config.json
<APP_DIR>\bucket_styles.json
<APP_DIR>\logs...

Wizard requirements:

* Ask “Enable Portable Mode?” with explanation.
* UI must show current config location (Portable/AppData + full path).
* Button: Open Config Folder.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
STYLE SYSTEM (bucket_styles.json)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Source file: bucket_styles.json

Structure (strict):
{
"categories": { ... },
"buckets": { ... }
}

Style resolution fallback (SAFE):

1. Exact bucket match
2. Case-insensitive bucket match
3. Category fallback
4. Hard default fallback (IconIndex=0, neutral color)

Missing style:

* Never stop execution.
* Log once per bucket/category (no spam).

Customization in GUI:

* Users can edit **Color** and **IconIndex** in the GUI for each bucket/category.
* Users can rename bucket display/folder names via a dedicated buckets config (below).

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
BUCKET SYSTEM (NO CUSTOM BUCKET ADDING YET)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Users CANNOT add brand-new buckets in v2.
They CAN rename existing buckets (example: “808s” → “808”).

To support this cleanly, implement:

* A separate file: `buckets.json` (stored alongside config/styles in AppData/Portable)
* It defines fixed bucket IDs and user-chosen display/folder names.

Bucket IDs are FIXED internally (e.g., "808s"), but output folder naming uses the rename mapping.

Requirements:

* Engine uses bucket IDs for classification/rules.
* Output folder names use user mapping from buckets.json.
* If user renames “808s” → “808”, hub folder should be `...\808\` (folder rename applies on disk).
* UI shows editable names for each fixed bucket.
* If renamed, repair-styles must also correct `.nfo` placement accordingly.

Deliver:

* `buckets.schema.json` and validation.
* GUI editor for bucket names with reset-to-default.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ROUTING / BUCKETING (DETERMINISTIC + LOGGED)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Classification must be deterministic rule-based scoring:

* For each file, compute scores for fixed buckets.
* Choose highest score.
* Confidence score required.
* Log why: matching rules, score totals, and confidence.

Low-confidence default:

* Route to: HUB\UNSORTED<PackName>...
* Preserve vendor structure under pack.

Always ignore by default:

* __MACOSX
* .DS_Store
* ._*

Ignore list must be editable in UI.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
WIZARD EXPERIENCE (REQUIRED, UX-FIRST)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
GUI: PySide6 (Qt)

UX requirements:

* Professional, modern UI with custom theme (best possible).
* System/Dark/Light themes (System default).
* Must look clean and “app-like”, not a script UI.
* Custom app logo provided by user (load from repo assets).

Startup behavior:

* Remember settings.
* Open **Run page first** by default after first setup.
* Provide a “Wizard” or “Settings” button to revisit steps.

Wizard pages:
Step 1 – Inbox

* Folder picker for Inbox
* Show detected packs count
* Show ignore rules preview

Step 2 – Hub

* Folder picker for Hub
* Show categories/buckets preview
* Button: Open Hub Folder

Step 3 – Options

* Default run mode list is visible but:

  * DEFAULT = Copy
  * Analyze + Dry-run are hidden unless Developer Tools enabled
* Overwrite NFO? (only if different; default safe)
* Pack name normalization toggle (default OFF)
* Ignore rules editor (editable list)
* Portable mode toggle + explanation
* Show config mode + full path
* Button: Open Config Folder
* Developer Tools toggle (off by default)

  * Verbose logging
  * Show scoring breakdown
  * Dump debug classification JSON
  * Show rule matches
    Each option must explain what it does.

Step 4 – Run + Report

* Big Run button
* Live log panel (no stack traces; friendly error text)
* After run: summary + buttons:

  * Open Run Log Folder
  * Open audit.csv (if move)
  * Open report.json
* Visible buttons:

  * Repair Styles
  * Undo Last Move

Theme:

* Apply instantly; save “theme” to config.
* Implement apply_theme(app, theme: str) with palette + stylesheet.
* System theme resets palette + stylesheet.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
CLI SUPPORT (REQUIRED)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Entry: `python -m producer_os.cli`

Commands:
analyze
dry-run
copy
move
repair-styles
preview-styles
doctor
undo-last-run

CLI must respect portable mode (portable.flag + --portable).

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
UNDO LAST RUN (MOVE MODE ONLY)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
For move runs:

* Write audit.csv (src,dst,decision,reason).
* Undo reads latest audit.csv and attempts to move files back.
* Conflicts go to HUB\Quarantine\UndoConflicts\
* Never delete files.

Audit CSV columns:
file,pack,category,bucket,confidence,action,reason

For UNSORTED:

* log top 3 bucket candidates with scores.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
REPAIR MODE 2.0 (repair-styles)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
repair-styles must:

* Regenerate missing category/bucket/pack `.nfo`
* Remove orphan `.nfo`
* Fix wrong placement
* Reapply styles from current JSON
* Respect bucket renames (buckets.json) and fix any mismatches

Never touch user audio files other than `.nfo`.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
LOGGING + REPORTS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Per run:
HUB\logs<run_id>
run_log.txt
run_report.json
audit.csv

Also implement “Export Debug Report” in Developer Tools:

* Zips logs + config + styles + buckets mapping
* No user audio included

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
OPEN SOURCE QUALITY (GPL-3.0-or-later)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Add/ensure:

* LICENSE = GPL-3.0-or-later
* README.md: quickstart, wizard guide, CLI guide, NFO rules, portable mode
* SUPPORT.md
* .github/ISSUE_TEMPLATE (bug + feature)
* JSON schemas: config.schema.json, styles.schema.json, buckets.schema.json
* JSON validation on startup; friendly UI errors (no stack traces)

Repo layout:

* Use src layout: `src/producer_os/...`

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
PACKAGING (WINDOWS EXE)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Packager: **Nuitka**
Output: **single-folder** distribution

Deliverables:

1. Portable zip build (folder zipped)
2. Inno Setup installer
3. GitHub Actions workflow:

   * builds on Windows runner
   * caches dependencies
   * produces artifacts (zip + installer)
   * (optional) GitHub Release on tag

Ensure portable.flag works when placed next to the EXE.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
TESTING (MANDATORY)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Provide:

* Test data generator (dummy packs + WAVs)
* Automated tests for:

  1. NFO placement rules
  2. No per-wav `.nfo`
  3. Idempotency
  4. Style fallback
  5. Undo-last-run
  6. Repair-styles correction
  7. Portable mode detection
* Provide exact PowerShell commands to run tests and expected outputs.
* Include a “first run + second run” expected behavior section.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
DELIVERY CHECKLIST
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

* GUI wizard complete + opens Run first after setup
* Copy default; analyze/dry-run only visible when Dev Tools enabled
* Portable/AppData mode correct with portable.flag priority
* `.nfo` placement correct + iconindex-only
* Idempotent runs
* Undo last move works, conflicts quarantined
* Repair-styles fixes orphans/misplacements + respects bucket renames
* Nuitka build works; Inno installer works; zip build works
* GitHub Actions builds artifacts
* Docs complete, schemas validate, friendly errors in UI

---

## Notes the agent must follow

* Do NOT invent bucket names or icon indices.
* Use the fixed bucket set already defined in the project and expose it in buckets.json.
* Logo file is already provided in repo assets; integrate it into UI and installer.
* UI must remain “thin”: no routing logic in UI.

---